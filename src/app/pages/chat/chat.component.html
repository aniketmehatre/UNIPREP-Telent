<p-card [style]="{ width: '100%', height: 'auto' }">
  <ng-template pTemplate="header">
    CHAT
    <br />
    <p class="userinfo">Hello {{ username }}.</p>
    <div class="info row desktop">
      <div class="col-2 chatguide">
        <button routerLink="/pages/guideline">Chat Guidelines</button>
      </div>
      <div class="col-8 chat-info">
        <p>
          Welcome to UNIPREP.Your have 1 free question credits. Your
          personalised questions will be answered by the experts. Each message
          will be considered as 1 credit.
        </p>
      </div>
      <div class="col-2 report">
        <button (click)="op?.toggle($event)">Report</button>
      </div>
    </div>
    <div class="info row mobile">
      <div class="chat-info">
        <p>
          Welcome to UNIPREP.Your have 1 free question credits. Your
          personalised questions will be answered by the experts. Each message
          will be considered as 1 credit.
        </p>
      </div>
      <div class="d-flex justify-content-between">
        <div class="chatguide">
          <button routerLink="/pages/guideline">Chat Guidelines</button>
        </div>
        <div class="report">
          <button (click)="op?.toggle($event)">Report</button>
        </div>
      </div>
    </div>
    <p-divider></p-divider
  ></ng-template>
  <ng-template pTemplate="body">
    <div class="chatcontainer">
      <div *ngFor="let message of messages; let i = index">
        <div class="message-container msger-chat">
          <div class="msg left-msg" *ngIf="message.admin_message != 0">
            <div class="msg-img-admin">
              <img src="../../../uniprep-assets/images/icon-light.svg" />
            </div>
            <div class="msg-info">
              <div class="msg-info-name">
                UNIPREP
                <div class="msg-info-time">
                  {{ message.created_at | date : "short" }}
                </div>
              </div>
            </div>
          </div>
          <div class="msg left-msg" *ngIf="message.admin_message != 0">
            <div class="msg-bubble">
              <p [innerHtml]="getData(message.answerForQuestion)"></p>
              <div
                class="msg-text"
                *ngIf="
                  message.message != 'undefined' && message.message != undefined
                "
                [innerHTML]="message.message"
              ></div>
              <div
                class="folder-card"
                *ngIf="message.attachment"
                (click)="openAttachment(message.attachment)"
              >
                <div class="d-flex folder">
                  <div class="me-2 d-flex align-items-center">
                    <img
                      class="img-responsive"
                      src="../../../uniprep-assets/images/pdf.svg"
                    />
                  </div>
                  <div class="folderinfo" [pTooltip]="message.filename">
                    <h5>{{ message?.filename }}</h5>
                    <label>
                      Last Updated:<span>{{
                        message.created_at | date : "short"
                      }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="msg left-msg" *ngIf="message.admin_message == 0">
            <div class="msg-img">{{ message.sendByName.slice(0, 1) }}</div>
            <div class="msg-info">
              <div class="msg-info-name">
                {{ message.sendByName }}
                <div class="msg-info-time">
                  {{ message.created_at | date : "short" }}
                </div>
              </div>
            </div>
          </div>
          <div class="msg left-msg" *ngIf="message.admin_message == 0">
            <div class="msg-bubble">
              <div
                class="msg-text"
                *ngIf="
                  message.message != 'undefined' && message.message != undefined
                "
                [innerHTML]="message.message"
              ></div>
            </div>
          </div>
        </div>
        <p-divider></p-divider>
      </div>
    </div>
  </ng-template>
  <ng-template pTemplate="footer">
    <div>
      <div
        class="row togglediv"
        *ngIf="!textareavisbility"
        (click)="textareavisbility = !textareavisbility"
      >
        <div class="col-7 customplaceholder">Please ask your question...</div>
        <div class="col-5 credits">
          <span
            >Credits <span>{{ totalcredits }}</span></span
          >
        </div>
      </div>
      <div [class]="fullscreen" #fullscreeneditor>
        <div *ngIf="textareavisbility" class="col credits-div">
          <span class="credits-span"
            >Credits <span class="creditscore">{{ totalcredits }}</span></span
          >
        </div>
        <p-editor
          *ngIf="textareavisbility"
          [(ngModel)]="textMessage"
          [modules]="modules"
        >
          <ng-template pTemplate="header"></ng-template>
        </p-editor>
      </div>
      <div class="text-end">
        <p-confirmPopup
          [style]="{ 'z-index': '999999 !important' }"
        ></p-confirmPopup>
      </div>
    </div>
    <div class="d-flex justify-content-end sendbtn">
      <button
        *ngIf="btnsendmessage == 1"
        (click)="confirm($event)"
        class="btn btn-primary px-4 py-2 h5 m-0"
      >
        Send Message
      </button>
      <button
        *ngIf="btnsendmessage == 2"
        (click)="content.toggle($event)"
        class="btn btn-primary px-4 py-2 h5 m-0"
      >
        Send Message
      </button>
      <button
        *ngIf="btnsendmessage == 3"
        class="btn btn-primary px-4 py-2 h5 m-0"
      >
        Send Message
      </button>
    </div>
    <div class="d-flex justify-content-end sendbtn"></div>
  </ng-template>
</p-card>
<p-overlayPanel
  [position]="'top'"
  styleClass="overlaypanel"
  [style]="{ width: '245px' }"
  #content
  [appendTo]="'body'"
>
  <ng-template pTemplate="content">
    <span>{{ planmessage }}</span>
  </ng-template>
</p-overlayPanel>
<p-overlayPanel #op>
  <form [formGroup]="reportForm" (ngSubmit)="reportSubmit()" #reportFormElm>
    <div class="col-md-12 mt-1">
      <div class="form-group">
        <label
          >Report Issues<span style="color: red; font-weight: bold"
            >*</span
          ></label
        >
        <p-dropdown
          formControlName="reportOption"
          optionValue="id"
          optionLabel="reportoption_name"
          styleClass="w-full"
          [options]="reportOptions"
        ></p-dropdown>
      </div>
    </div>
    <br />
    <div class="col-md-12 mt-1">
      <div class="form-group">
        <label
          >Add Comment
          <span style="color: red; font-weight: bold">*</span></label
        >
        <textarea
          class="w-100"
          rows="3"
          cols="35"
          required
          pInputTextarea
          formControlName="comment"
        ></textarea>
      </div>
    </div>

    <div class="row mt-3 mt-1">
      <button
        class="ps-3 pe-3 pt-2 pb-2"
        pButton
        type="submit"
        style="
          background-color: var(--uniprep-primary);
          border-radius: 8px;
          border: aliceblue;
          color: #fff;
        "
        label="SUBMIT"
      ></button>
    </div>
  </form>
</p-overlayPanel>
<p-dialog [visible]="visibility" [closable]="false" [modal]="true">
  <div
    style="
      background: var(--uniprep-primary) !important;
      border-radius: 50% !important;
      height: 25px !important;
      width: 25px !important;
      position: absolute;
      right: -10px;
      top: -10px;
      text-align: center;
      cursor: pointer;
    "
    (click)="visibility = !visibility"
  >
    <i style="color: #fff" class="fa fa-close"></i>
  </div>
  <div class="row mt-1">
    <div class="col-2" style="margin: auto; padding: 1.5rem">
      <span
        style="
          color: white;
          text-align: center;
          vertical-align: middle;
          background-color: var(--uniprep-primary);
          border-radius: 50%;
        "
        ><i style="height: 20px; width: 20px" class="fa fa-info"></i
      ></span>
    </div>
    <div class="col-10 mb-4" style="margin: auto; padding: 1rem">
      <b
        >Thank you for reaching out to us.<br />
        Please anticipate a response within<br />
        8 working hours.</b
      >
    </div>
  </div>
</p-dialog>
<p-dialog
  [visible]="creditspopupVisibility"
  [closable]="false"
  [modal]="true"
  [style]="{ width: '20vw' }"
>
  <div
    style="
      background: var(--uniprep-primary) !important;
      border-radius: 50% !important;
      height: 25px !important;
      width: 25px !important;
      position: absolute;
      right: -10px;
      top: -10px;
      text-align: center;
      cursor: pointer;
    "
    (click)="creditspopupVisibility = !creditspopupVisibility"
  >
    <i style="color: #fff" class="fa fa-close"></i>
  </div>
  <div class="row mt-1">
    <div class="col-2" style="margin: auto; padding: 1.5rem">
      <span
        style="
          color: white;
          text-align: center;
          vertical-align: middle;
          background-color: var(--uniprep-secondary);
          border-radius: 50%;
        "
        ><i style="height: 20px; width: 20px" class="fa fa-info"></i
      ></span>
    </div>
    <div class="col-10" style="margin: auto; padding: 1rem">
      Your question credits are exhausted! Additional credits will be available
      at 12:00 AM tommorow.
    </div>
  </div>
</p-dialog>
