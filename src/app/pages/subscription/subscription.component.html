<ng-container [ngSwitch]="stage">
	<ng-container *ngSwitchCase="1">
		<ng-container *ngIf="studentType===1">
			<uni-subscription-data #applyTarget (upgrade)="start()" [history]="(orderHistory$ | async) || []" [billing]="user"
				[subscriptions]="subscriptionDetail$ | async" (subscriptionPlan)="pay($event)" [showHistoryBtn]="showHistoryBtn"
				(showHistory)="showHistory($event)" (subscriptionDataLoaded)="onSubscriptionDataLoaded($event)">
			</uni-subscription-data>
		</ng-container>
		<ng-container *ngIf="studentType===2">
			<uni-clg-subscription-data #applyTarget (upgrade)="start()" [history]="(orderHistory$ | async) || []"
				[billing]="user" [subscriptions]="subscriptionDetail$ | async" (subscriptionPlan)="pay($event)"
				[showHistoryBtn]="showHistoryBtn" (showHistory)="showHistory($event)"
				(subscriptionDataLoaded)="onSubscriptionDataLoaded($event)">
			</uni-clg-subscription-data>
		</ng-container>
	</ng-container>

	<ng-container *ngSwitchCase="2">
		<uni-subscription-list [whichOneVisible]="isSubOrQuestion" (selected)="onSelectSubscription($event)"
			(selectedCredit)="onSelectQuestionCredit($event)" [country]="countryList"
			[plans]="(subscriptions$ | async) || []">
		</uni-subscription-list>
	</ng-container>

	<ng-container *ngSwitchCase="3">
		<uni-subscription-billing (pay)="pay($event)" (payQuestionCredit)="payQuestionCredit()" (change)="changePlan()"
			(changeQuestionCreditPlan)="changeQuestionCreditPlan()" [loading]="(orderLoading$ | async) || false"
			[plan]="selectedSubscription" [planQuestionCredit]="selectedQuestionCredit">
		</uni-subscription-billing>
	</ng-container>

	<ng-container *ngSwitchCase="4">
		<uni-subscription-success [plan]="success">
		</uni-subscription-success>
	</ng-container>

	<ng-container *ngSwitchCase="5">
		<uni-subscription-history [userSubscription]="userSubscription" [subscribedHistoryList]="subscribedHistoryData"
			(showPlan)="showPlan($event)" [showPlanBtn]="showPlanBtn" [subscribedCountryList]="subscribedCountryList"
			[accountBillingList]="accountBillingData">
		</uni-subscription-history>
	</ng-container>

	<p-dialog [(visible)]="cardvisibility" [style]="{ width: '40vw', height: 'auto' }"
		[breakpoints]="{ '960px': '50vw', '959px': '80vw', '425px': '90vw' }" (onHide)="onCloseStripe()">
		<div style="padding: 2rem !important">
			@if (elementsOptions.clientSecret) {
			<ngx-stripe-payment [elementsOptions]="elementsOptions"></ngx-stripe-payment>
			}
			<button pButton class="mt-5 pt-3 pb-3 btn btn-basic w-100 m-0 btn btn-primary" (click)="paywithstripe()">
				<i class="fa-solid fa-lock mx-2"></i>
				Pay {{ subscriptionCurrency }} {{ subscriptionDetails?.finalPrice }}
			</button>
		</div>
	</p-dialog>
</ng-container>
<p-dialog [(visible)]="showPremimumPopup" [modal]="true" [draggable]="false" [resizable]="false" class="why-premium"
	[breakpoints]="{ '960px': '60vw', '959px': '75vw', '425px': '90vw' }" [closable]="false">
	<ng-template pTemplate="header">
		<div class="d-flex justify-content-between gap-2 w-100">
			<h3>üöÄ This Job Can Only Be Applied by Verified Candidates!</h3>
			<button class="btn btn-primary btn-rounded" (click)="onClosePremiumPopup()"><i class="fa fa-times"></i></button>
		</div>
	</ng-template>
	<div class="row">
		<div class="col-12">
			<h6 class="mb-3 fw-semibold">Verify Now & Get Instant Access To:</h6>
			<div class="d-flex flex-column gap-3">
				@for (feature of premiumFeatures; track $index) {
				<div class="d-flex align-items-center">
					<span [innerHTML]="feature"></span>
				</div>
				}
			</div>
			<h5 class="mt-3 mb-0 fw-semibold">Once Verified, you can apply to 30,000+ jobs worldwide without restrictions!
			</h5>
			<h4 class="uniprep-primary mt-2">‚≠ê 52,382 job seekers are already verified this month.</h4>
		</div>
	</div>
	<div class="center-align mt-3">
		<button pButton class="btn-secondary px-5" [rounded]="true" type="button" (click)="applyNow()">Get Verified & Apply
			Now</button>
	</div>
</p-dialog>


<!-- Get Verified Modal -->
<p-dialog [(visible)]="showVerificationModal" [modal]="true" [draggable]="false" [resizable]="false" 
  [style]="{ width: '40rem' }" 
  [breakpoints]="{ '960px': '50vw', '959px': '80vw', '425px': '90vw' }"
  [closable]="true"
  styleClass="verification-modal">
  <ng-template pTemplate="header">
    <div class="d-flex justify-content-between align-items-center w-100">
      <h4 class="mb-0 fw-semibold">üöÄ Get Verified to Be Shortlisted for This Job</h4>
      <button class="btn btn-link p-0 text-primary" (click)="closeVerificationModal()" style="font-size: 1.25rem;">
        <!-- <i class="fa-solid fa-xmark"></i> -->
      </button>
    </div>
  </ng-template>
  
  <div class="verification-modal-content">
    <p class="mb-4 text-secondary">
      Your profile matches this role. Verification is required before employer shortlisting.
    </p>

    <div class="mb-4">
      <h6 class="mb-3 fw-semibold">Benefits of verification:</h6>
      <div class="d-flex flex-column gap-3">
        <div class="d-flex align-items-start gap-2">
          <i class="fa-solid fa-circle-check text-success mt-1" style="font-size: 1.1rem;"></i>
          <span>Interview opportunity with hiring companies</span>
        </div>
        <div class="d-flex align-items-start gap-2">
          <i class="fa-solid fa-circle-check text-success mt-1" style="font-size: 1.1rem;"></i>
          <span>1:1 career expert call to review & verify your profile</span>
        </div>
        <div class="d-flex align-items-start gap-2">
          <i class="fa-solid fa-circle-check text-success mt-1" style="font-size: 1.1rem;"></i>
          <span>Priority access to premium jobs</span>
        </div>
        <div class="d-flex align-items-start gap-2">
          <i class="fa-solid fa-circle-check text-success mt-1" style="font-size: 1.1rem;"></i>
          <span>70+ career, education & entrepreneur tools</span>
        </div>
        <div class="d-flex align-items-start gap-2">
          <i class="fa-solid fa-circle-check text-success mt-1" style="font-size: 1.1rem;"></i>
          <span>Faster employer response on verified profiles</span>
        </div>
      </div>
    </div>

    <div class="mb-3 d-flex align-items-center gap-2">
      <i class="fa-solid fa-lock text-primary"></i>
      <span class="text-secondary">Employers prefer verified profiles during shortlisting.</span>
    </div>

    <div class="mb-4 d-flex align-items-center gap-2">
      <i class="fa-solid fa-star text-warning"></i>
      <span class="text-secondary">20,000+ job seekers get verified every month on UNIPREP</span>
    </div>

    <div class="text-center">
      <button pButton class="btn btn-primary px-5 py-3 fw-semibold" [rounded]="true" 
        type="button" (click)="onGetVerified()" 
        style="background-color: #ff6b35; border-color: #ff6b35; min-width: 200px;">
        Get Verified
      </button>
    </div>
  </div>
</p-dialog>
