<h6 class="sub-label">Subscription</h6>
<div class="card mb-2 bg-white" *ngFor="let subscription of userSubscription">
	<div class="card-body">
		<div class="d-flex flex-column flex-md-row justify-content-md-between justify-content-center">
			<div class="text-md-start text-center">
				<h2 class="mb-0">{{ subscription.plan }} Plan</h2>
				<span>{{ subscription.remainingdays }} Days Remaining</span>
			</div>
			<div>
				<div class="text-md-end text-center pt-3">
					<button pButton  class="btn upgradeplan" (click)="upgradePlan()">Upgrade Plan</button>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="card historycard mb-2 bg-white" *ngIf="basesubscription">
	<div class="card-body">
		<h3 class="sop-header mb-3">Subscription History</h3>
		<p-table [value]="subscribedHistoryList" class="subscriptiontable" responsiveLayout="scroll">
			<ng-template pTemplate="header">
				<tr>
					<th>Product</th>
					<th>Country</th>
					<th>Validity</th>
					<th>Date Started</th>
					<th>Date Ended</th>
					<th>Amount</th>
				</tr>
			</ng-template>
			<ng-template pTemplate="body" let-data>
				<tr class="subscription-history-header">
					<td>{{ data.product }}</td>
					<td>{{ data.country }}</td>
					<td>{{ data.validity }} months</td>
					<td>{{ data.startdate }}</td>
					<td>{{ data.enddate }}</td>
					<td>{{ data.amount }}</td>
				</tr>
			</ng-template>
		</p-table>
	</div>
</div>
<div class="card historycard bg-white" *ngIf="basesubscription">
	<div class="card-body">
		<h3 class="sop-header mb-3">Account Billing History</h3>
		<p-table [value]="accountBillingList" class="subscriptiontable" responsiveLayout="scroll">
			<ng-template pTemplate="header">
				<tr>
					<th>Product</th>
					<th>Country</th>
					<th>Validity</th>
					<th>Reference</th>
					<th>Date</th>
					<th>Amount</th>
					<th>Status</th>
					<th>Download</th>
				</tr>
			</ng-template>
			<ng-template pTemplate="body" let-data>
				<tr class="account-history-header">
					<td>{{ data.product }}</td>
					<td>{{ data.countryNames }}</td>
					<td>{{ data.validity }} <span *ngIf="data.validity!='-'">months</span></td>
					<td>{{ data.reference }}</td>
					<td>{{ data.date }}</td>
					<td>{{ data.amount }}</td>
					<td><i class="fa-solid fa-check" style="color: aquamarine"></i></td>
					<td>
						<button pButton  class="btn btn-primary" (click)="downloadInvoice(data.id)"
							*ngIf="data.invoice != 'no' else noData"><i class="fa-solid fa-download"></i></button>
						<ng-template #noData>
							<div class="ms-4">-</div>
						</ng-template>
					</td>
				</tr>
			</ng-template>
		</p-table>
	</div>
</div>

<div class="card d-flex bg-white">
	<div class="card">
		<div class="row" *ngIf="basesubscription">
			<div *ngFor="let subscription of subscriptionList" class="col-lg-4">
				<div class="card-body">
					<div class="container-fluid">
						<div class="row gap-5 mt-4 d-flex">
							<div class="card card-bg subscriptioncard col px-0"
								[ngClass]="{ active: subscription.popular == 1 }">
								<div class="mostpopular" *ngIf="subscription.popular == 1">Most Popular Plan</div>
								<div class="card-header p-4">
									<div class="d-flex justify-content-between align-items-center">
										<h3 class="fw-bold mb-0">{{ subscription.subscription_plan }} <br />Plan</h3>
										<div class="text-end">
											<h4 class="mb-0">
												<s>INR {{ subscription.actualprice | number : ".2-2" }}</s>
											</h4>
											<div class="btn discountbutton">
												Save {{ subscription.discountpercentage }}
												%
											</div>
										</div>
									</div>
								</div>
								<div class="card-body p-4">
									<h5 style="font-size: 18px; text-align: center">Select Your Base Country</h5>
									<span class="p-float-label">
										<p-select [options]="subscription.filteredCountryList" styleClass="w-100"
											[(ngModel)]="subscription.selectedCoutry" optionLabel="country">
											<ng-template pTemplate="selectedItem">
												<img [src]="subscription.selectedCoutry?.flag"
													[alt]="subscription.selectedCoutry?.altname"
													class="base-country-flag" />
												{{ subscription.selectedCoutry?.country }}
											</ng-template>
										</p-select>
									</span>
									<h5 style="font-size: 18px; text-align: center" class="pt-4">Personalized Question:
										{{ subscription.chatlimit }} / day</h5>
								</div>
								<div class="card-footer p-4" style="text-align: center">
									<h2 class="font-primarycolor fw-bold">INR {{ subscription.givenprice | number :
										".2-2" }}</h2>
									<p class="fw-semibold">{{ subscription.validity }} Month Validity</p>
									<div class="getstartedbtn">
										<button pButton  *ngIf="!subscription.selected" class="btn btn-primary"
											(click)="selectedSubscriptionPlan(subscription)">Select This Plan</button>
										<button pButton  *ngIf="subscription.selected" class="btn dark-btn"
											(click)="selectedSubscriptionPlan(subscription)">You have selected {{
											subscription.subscription_plan }} Plan</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Top-up-countries -->
		<div class="row" *ngIf="topupcountries">
			<div *ngFor="let subscription of subscriptionTopupList" class="col-lg-4">
				<div class="card-body">
					<div class="container-fluid">
						<div class="row gap-5 mt-4 d-flex">
							<div class="card card-bg subscriptioncard col px-0"
								[ngClass]="{ active: subscription.popular == 1 }">
								<div class="mostpopular" *ngIf="subscription.popular == 1">Most Popular Plan</div>
								<div class="card-header p-4">
									<div class="d-flex justify-content-between align-items-center">
										<h3 class="fw-bold mb-0">{{ subscription.name }} <br />Plan</h3>
										<div class="text-end">
											<h4 class="mb-0">
												<s>INR {{ subscription.price | number : ".2-2" }}</s>
											</h4>
											<div class="btn discountbutton">Save {{ subscription.discountPercentage }} %
											</div>
										</div>
									</div>
								</div>
								<div class="card-body p-3">
									<h5 style="font-size: 18px; text-align: center">Select Your Add On Countries</h5>
									<p-multiSelect [options]="subscription.filteredCountryList" styleClass="w-100"
										[(ngModel)]="subscription.selectedCoutriesList"
										defaultLabel="Select a multiple countries as per your requirement"
										optionLabel="country" #multiSelect>
										<ng-template pTemplate="selectedItems">
											{{ multiSelect.defaultLabel }}
										</ng-template>
									</p-multiSelect>
									<div class="d-flex align-items-center gap-2 flex-wrap pt-2">
										<div *ngFor="let data of subscription?.selectedCoutriesList">
											<p-chip [label]="data.country" [image]="data.flag" [removable]="true"
												(onRemove)="removeCountry(subscription.id, data.id)"
												removeIcon="pi pi-times"></p-chip>
										</div>
									</div>
								</div>
								<div class="card-footer p-4" style="text-align: center">
									<h2 class="font-primarycolor fw-bold">INR {{ subscription.finalamount | number :
										".2-2" }}</h2>
									<p class="fw-semibold">{{ subscription.validity }} Month Validity</p>
									<div class="getstartedbtn">
										<button pButton  *ngIf="!subscription.selected" class="btn btn-primary"
											(click)="selectedTopupCountryPlan(subscription)">Select Plan</button>
										<button pButton  *ngIf="subscription.selected" class="btn dark-btn"
											(click)="selectedTopupCountryPlan(subscription)">You have selected {{
											subscription.name }} Plan</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- top up validity -->
		<div class="row p-3" *ngIf="topupvalidity">
			<div class="d-flex justify-content-between">
				<div class="mt-2">
					<label for="" style="white-space: nowrap">Select Country for Validity</label>
				</div>
				<div class="ms-2" style="width: -webkit-fill-available">
					<span class="p-float-label">
						<p-multiSelect [options]="countryList" optionValue="id" placeholder="Select a country"
							[(ngModel)]="selectedCountry" styleClass="w-100 custom-multiselect"
							optionLabel="country"></p-multiSelect>
					</span>
				</div>
			</div>
		</div>
		<div class="cardcontainer" *ngIf="topupvalidity">
			<div class="card-body sameline">
				<div class="container-fluid">
					<div class="row gap-5 mt-4 d-flex">
						<div class="card col px-0">
							<!-- <div class="mostpopular">Most Popular Plan</div> -->
							<div class="card-header p-4">
								<div class="d-flex justify-content-between align-items-center">
									<h6 class="fw-bold mb-0">1 Month <br />Validity</h6>
									<div class="text-end">
										<span class="mb-0"><s>INR 1000</s></span>
										<div class="btn discountbutton">Save 20 %</div>
									</div>
								</div>
							</div>
							<div class="card-footer p-4 pt-5" style="text-align: center">
								<h4 class="font-primarycolor fw-bold">INR 699.00</h4>
								<div class="">
									<button pButton  style="width: -webkit-fill-available" class="btn btn-primary"><span
											style="color: var(--p-neutral-50) !important" class="ps-5 pe-5">Top Up</span></button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="card-body sameline">
				<div class="container-fluid">
					<div class="row gap-5 mt-4 d-flex">
						<div class="card col px-0">
							<!-- <div class="mostpopular">Most Popular Plan</div> -->
							<div class="card-header p-4">
								<div class="d-flex justify-content-between align-items-center">
									<h6 class="fw-bold mb-0">1 Month <br />Validity</h6>
									<div class="text-end">
										<span class="mb-0"><s>INR 1000</s></span>
										<div class="btn discountbutton">Save 20 %</div>
									</div>
								</div>
							</div>
							<div class="card-footer p-4 pt-5" style="text-align: center">
								<h4 class="font-primarycolor fw-bold">INR 699.00</h4>
								<div class="">
									<button pButton  style="width: -webkit-fill-available" class="btn btn-primary"><span
											style="color: var(--p-neutral-50) !important" class="ps-5 pe-5">Top Up</span></button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="card-body sameline">
				<div class="container-fluid">
					<div class="row gap-5 mt-4 d-flex">
						<div class="card col px-0">
							<!-- <div class="mostpopular">Most Popular Plan</div> -->
							<div class="card-header p-4">
								<div class="d-flex justify-content-between align-items-center">
									<h6 class="fw-bold mb-0">1 Month <br />Validity</h6>
									<div class="text-end">
										<span class="mb-0"><s>INR 1000</s></span>
										<div class="btn discountbutton">Save 20 %</div>
									</div>
								</div>
							</div>

							<div class="card-footer p-4 pt-5" style="text-align: center">
								<h4 class="font-primarycolor fw-bold">INR 699.00</h4>
								<div class="">
									<button pButton  style="width: -webkit-fill-available" class="btn btn-primary"><span
											style="color: var(--p-neutral-50) !important" class="ps-5 pe-5">Top Up</span></button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="card-body sameline">
				<div class="container-fluid">
					<div class="row gap-5 mt-4 d-flex">
						<div class="card col px-0">
							<!-- <div class="mostpopular">Most Popular Plan</div> -->
							<div class="card-header p-4">
								<div class="d-flex justify-content-between align-items-center">
									<h6 class="fw-bold mb-0">1 Month <br />Validity</h6>
									<div class="text-end">
										<span class="mb-0"><s>INR 1000</s></span>
										<div class="btn discountbutton">Save 20 %</div>
									</div>
								</div>
							</div>

							<div class="card-footer p-4 pt-5" style="text-align: center">
								<h4 class="font-primarycolor fw-bold">INR 699.00</h4>
								<div class="">
									<button pButton  style="width: -webkit-fill-available" class="btn btn-primary"><span
											style="color: var(--p-neutral-50) !important" class="ps-5 pe-5">Top Up</span></button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="card-body sameline">
				<div class="container-fluid">
					<div class="row gap-5 mt-4 d-flex">
						<div class="card col px-0">
							<!-- <div class="mostpopular">Most Popular Plan</div> -->
							<div class="card-header p-4">
								<div class="d-flex justify-content-between align-items-center">
									<h6 class="fw-bold mb-0">1 Month <br />Validity</h6>
									<div class="text-end">
										<span class="mb-0"><s>INR 1000</s></span>
										<div class="btn discountbutton">Save 20 %</div>
									</div>
								</div>
							</div>
							<div class="card-footer p-4 pt-5" style="text-align: center">
								<h4 class="font-primarycolor fw-bold">INR 699.00</h4>
								<div class="">
									<button pButton  style="width: -webkit-fill-available" class="btn btn-primary"><span
											style="color: var(--p-neutral-50) !important" class="ps-5 pe-5">Top Up</span></button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- last know more about section -->
<div class="row" *ngIf="topupcountries">
	<div class="col-lg-5">
		<div [class]="'card card-body mt-3 h-100 justify-content-center'">
			<div class="row">
				<div class="mt-1 col-lg-6">
					<span style="font-size: 16px !important" class="sop-header"><b>Checkout What You Get With Our
							Subscriptions</b></span>
				</div>
				<div class="col-lg-6">
					<button pButton  (click)="moreabout()" style="color: var(--p-neutral-50) !important" class="btn btn-primary"><span
							style="white-space: nowrap"> Know More About Our Features</span></button>
				</div>
			</div>
		</div>
	</div>
	<div class="col-lg-4">
		<div [class]="'card card-body mt-3 h-100'">
			<div>
				<span style="font-size: 13px !important" class="sop-header"><b>Apply your coupon code here</b></span>
				<br />
				<p-inputgroup class=" inputheight mt-1">
					<input [(ngModel)]="couponInput" pInputText placeholder="Enter Your coupon code Here" type="text" />
					<button pButton  (click)="applyCoupon()" class="btn-primary" label="Apply" pButton pRipple
						type="button"></button>
				</p-inputgroup>
				<span *ngIf="invalidCoupon" style="font-size: 9px !important; color: lightgray !important">You entered
					an invalid discount code. Please check the code and try again</span>
			</div>
		</div>
	</div>
	<div class="col-lg-3">
		<div [class]="'card card-body mt-3 h-100 justify-content-center'">
			<div class="row">
				<div *ngIf="basesubscription" class="col-lg-6">
					<span style="font-size: 13px !important" class="sop-header"><b>Total</b></span> <br />
					<span style="font-size: 15px !important; color: var(--p-primary-500) !important"
						class="sop-header"><b> INR {{ subscriptionTotal | number : ".2-2" }}</b></span>
				</div>
				<div *ngIf="topupcountries" class="col-lg-6">
					<span style="font-size: 13px !important" class="sop-header"><b>Countries</b></span>
					<span style="font-size: 13px !important; color: var(--p-primary-500) !important"
						class="sop-header"><b> {{ selectedTopupCountryDetails?.selectedCoutriesList?.length
							}}</b></span><br />
					<span style="font-size: 13px !important" class="sop-header"><b>Total</b></span>
					<span style="font-size: 13px !important; color: var(--p-primary-500) !important"
						class="sop-header"><b> INR {{ subscriptionTotal | number : ".2-2" }}</b></span>
				</div>
				<div class="col-lg-6">
					<button pButton  [disabled]="showCheckout" style="color: var(--p-neutral-50) !important" class="btn btn-primary"
						(click)="checkout()"><span class="ps-3 pe-3">Checkout</span></button>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- modeal -->

<p-dialog class="retrypopup" [modal]="true" [closable]="false" header="Header" footer="Footer"
	[(visible)]="isInstructionVisible" [style]="{ width: '27vw' }" [breakpoints]="{ '960px': '75vw' }"
	[draggable]="false" [resizable]="false">
	<ng-template pTemplate="header" style="overflow: hidden"> </ng-template>
	<span style="float: right"><i (click)="closeAllHome()"
			class="fa-solid fa-circle-xmark fa-2x custom-icon"></i></span>
	<div style="margin: 10px 10px 10px 10px">
		<div class="card text-center mt-1" style="background-color: #fbfbfb; padding: 10px">
			<h3 style="font-size: 18px" class="p-2">What You Get With The Subscription</h3>
		</div>
	</div>

	<div class="container-fluid bg-white">
		<div class="row">
			<div class="col-md-12">
				<div class="font-secondarycolor fw-medium lh-lg">
					<p>
						<span><i class="fa-solid fa-circle-check custom-icon1"></i>&nbsp;</span>Discover Unexplored
						Questions.
					</p>
					<p>
						<span><i class="fa-solid fa-circle-check custom-icon1"></i>&nbsp;</span>Earn A Certificate By
						Taking Quizzes
					</p>
					<p>
						<span><i class="fa-solid fa-circle-check custom-icon1"></i>&nbsp;</span>Share Your Certificates
						On Linkedin
					</p>
					<p>
						<span><i class="fa-solid fa-circle-check custom-icon1"></i>&nbsp;</span>Navigate Using Smart
						Keyword Search
					</p>
					<p>
						<span><i class="fa-solid fa-circle-check custom-icon1"></i>&nbsp;</span>Get Expert Answers To
						Your Queries
					</p>
					<p>
						<span><i class="fa-solid fa-circle-check custom-icon1"></i>&nbsp;</span>Find Answers To Your
						Question With Verified Source Links
					</p>
					<p>
						<span><i class="fa-solid fa-circle-check custom-icon1"></i>&nbsp;</span>Over half a million
						Questions And Answers Throughout Platform
					</p>
					<p>
						<span><i class="fa-solid fa-circle-check custom-icon1"></i>&nbsp;</span>Ask Any Personalized
						Questions & Get Answer Within 12 Working Hours
					</p>
				</div>
			</div>
		</div>
	</div>
</p-dialog>