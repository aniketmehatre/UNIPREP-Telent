<div class="card readingcard h-100">
	<div class="card-header border-0 bg-transparent">
		<div class="row">
			<div class="col-md-12 d-flex gap-2 text-center">
				<div class="backIcon d-md-flex d-none" role="button" routerLink="/pages/talent-connect/easy-apply">
					<span class="fa-solid fa-chevron-left"></span>
				</div>
				<div class="select-title d-flex justify-content-between align-items-center">
					<div>
						<h5 class="mb-0">Job Description</h5>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="card-body text-start flex-fill overflow-y-auto">
		<div class="row justify-content-between h-100">
			<div class="h-100 overflow-hidden" [ngClass]="!isShowApplyChat ? 'col-sm-12' : 'col-sm-12 col-md-7 col-lg-8 col-xl-9'" *ngIf="showInfo">
				<div class="card h-100 overflow-y-auto">
					<div class="card-header bg-transparent p-4">
						<div class="row align-items-start">
							<div class="col-xxl-1 col-xl-1 col-lg-2 col-md-2 col-sm-3 col-4">
								<div class="rounded-2 border overflow-hidden">
									<img class="company-logo" (error)="$event.target.src = '/uniprep-assets/images/job.webp'" [src]="jobDetails?.company_logo_url" alt="company_logo" />
								</div>
							</div>
							<div class="col-xxl-11 col-xl-11 col-lg-10 col-md-10 col-sm-9 col-8">
								<div class="row">
									<div class="col-xxl-10 col-xl-9 col-lg-8 col-md-12 col-sm-12 col-12 mb-3">
										<h3 class="fw-bold mb-0">{{ jobDetails?.position }}</h3>
										<div class="d-flex align-items-center">
											<span class="me-2 text-muted">{{ jobDetails.company_name }}</span>
											<span class="ms-1 text-primary" *ngIf="jobDetails">
												<i class="fas fa-check-circle"></i>
											</span>
										</div>
										<div>Job Id: {{ jobDetails.id }}</div>
									</div>
									<div class="col-xxl-2 col-xl-3 col-lg-4 col-md-12 col-sm-12 col-12 mb-3">
										<div class="row">
											<div class="col-12 text-md-end text-center mb-2 d-md-block d-none">
												<button pButton label="Close Info" class="btn btn-primary w-100" (click)="showInfo = false" *ngIf="isShowApplyChat && isApplied"></button>
												<button pButton class="p-button-success chat-btn w-100" *ngIf="!isShowApplyChat && isApplied" (click)="isShowApplyChat = true"><i class="pi pi-comments"></i> Chat</button>
												<button *ngIf="!isApplied" pButton label="Apply" icon="fa fa-arrow-pointer" iconPos="right" class="p-button-primary px-4" (click)="applyJob(jobId)" [disabled]="isApplied"></button>
											</div>
											<div class="d-block d-md-none">
												<button *ngIf="!isApplied" pButton label="Apply" icon="fa fa-arrow-pointer" iconPos="right" class="p-button-primary w-100" (click)="applyJob(jobId)" [disabled]="isApplied"></button>
												<button class="p-button-success chat-btn w-100" pButton *ngIf="isApplied" (click)="visible = true"><i class="pi pi-comments"></i> Chat</button>
											</div>
											<div class="col-12 text-lg-end text-start">
												<p class="posted-date">Posted On : {{ jobDetails.created_at | date : "dd-MM-yyyy" }}</p>
											</div>
										</div>
									</div>
									<div class="col-12 col-sm-12 col-md-12 d-none d-md-block">
										<div class="row align-items-center">
											<div class="col-md-3 col-6">
												<div class="d-flex align-items-center gap-3">
													<span><i class="fa-solid fa-user-magnifying-glass fa-lg"></i></span>
													<div>
														<p class="text-muted text-small mb-0">Total Vacancies</p>
														<h4 class="mb-0 fw-bold">{{ jobDetails.available_vacancies }}</h4>
													</div>
												</div>
											</div>
											<!-- <div class="col-md-3 col-6">
												<div class="d-flex align-items-center gap-3">
													<span><i class="fa-solid fa-user-tie fa-lg"
															style="color: #cc660a"></i></span>
													<div>
														<p class="text-muted text-small mb-0">Total Applications</p>
														<h4 class="mb-0 fw-bold">{{ jobDetails.total_applied }}</h4>
													</div>
												</div>
											</div> -->
											<div class="col-md-3 col-6">
												<div class="d-flex align-items-center gap-3">
													<span><i class="fa-solid fa-video fa-lg text-muted"></i></span>
													<div>
														<p class="text-muted text-small mb-0">Introduction Video</p>
														<h6 class="mb-0 fw-bold">{{ jobDetails.intro_video == "No" ? "Not Mandatory" : "Mandatory" }}</h6>
													</div>
												</div>
											</div>
											<div class="col-md-6 col-6">
												<p class="text-muted text-small mb-0">{{ jobDetails.matching_skills }}</p>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-12 col-sm-12 col-md-12 d-md-none d-block">
								<div class="row align-items-center">
									<div class="col-md-2 col-6">
										<div class="d-flex align-items-center gap-3">
											<span><i class="fa-solid fa-user-magnifying-glass fa-lg"></i></span>
											<div>
												<p class="text-muted text-small mb-0">Total Vacancies</p>
												<h4 class="mb-0 fw-bold">{{ jobDetails.available_vacancies }}</h4>
											</div>
										</div>
									</div>
									<!-- <div class="col-md-2 col-6">
										<div class="d-flex align-items-center gap-3">
											<span><i class="fa-solid fa-user-tie fa-lg"
													style="color: #cc660a"></i></span>
											<div>
												<p class="text-muted text-small mb-0">Total Applied</p>
												<h4 class="mb-0 fw-bold">{{ jobDetails.total_applied }}</h4>
											</div>
										</div>
									</div> -->
								</div>
							</div>
						</div>
					</div>
					<div class="card-body h-100 overflow-y-auto p-4">
						<div class="row mb-4">
							<div class="col-md-12">
								<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-6 g-3" [ngClass]="{ '!row-cols-lg-4': isShowApplyChat }">
									<!-- Start Date -->
									<div class="col-xxl-2 col-xl-3 col-lg-4 col-md-6 col-sm-6 col-6">
										<div class="d-flex flex-column">
											<div class="d-flex align-items-center mb-2">
												<i class="fas fa-calendar me-2" style="color: purple"></i>
												<div>
													<span class="text-muted">Start Date</span>
													<div class="fw-bold">{{ jobDetails.start_date }}</div>
												</div>
											</div>
										</div>
									</div>
									<!-- Due Date -->
									<div class="col-xxl-2 col-xl-3 col-lg-4 col-md-6 col-sm-6 col-6">
										<div class="d-flex flex-column">
											<div class="d-flex align-items-center mb-2">
												<i class="fa-solid fa-hourglass me-2" style="color: red"></i>
												<div>
													<span class="text-muted">Job Application Deadline</span>
													<div class="fw-bold">{{ jobDetails.due_date }}</div>
												</div>
											</div>
										</div>
									</div>
									<!-- Work Location -->
									<div class="col-xxl-2 col-xl-3 col-lg-4 col-md-6 col-sm-6 col-6">
										<div class="d-flex flex-column">
											<div class="d-flex align-items-center mb-2">
												<i class="fas fa-location-dot me-2" style="color: green"></i>
												<div>
													<span class="text-muted">Work Location</span>
													<div class="fw-bold">{{ jobDetails.work_location }}</div>
												</div>
											</div>
										</div>
									</div>
									<!-- Work Mode -->
									<div class="col-xxl-2 col-xl-3 col-lg-4 col-md-6 col-sm-6 col-6">
										<div class="d-flex flex-column">
											<div class="d-flex align-items-center mb-2">
												<i class="fa fa-building-user me-2" style="color: var(--secondary-500)"></i>
												<div>
													<span class="text-muted">Work Mode</span>
													<div class="fw-bold text-break">{{ Array.isArray(jobDetails.work_mode) ? jobDetails.work_mode.join(", ") : jobDetails.work_mode }}</div>
												</div>
											</div>
										</div>
									</div>
									<!-- Work Type -->
									<div class="col-xxl-2 col-xl-3 col-lg-4 col-md-6 col-sm-6 col-6">
										<div class="d-flex flex-column">
											<div class="d-flex align-items-center mb-2">
												<i class="fas fa-person-digging me-2" style="color: red"></i>
												<div>
													<span class="text-muted">Work Type</span>
													<div class="fw-bold text-break">{{ Array.isArray(jobDetails.employment_type) ? jobDetails.employment_type.join(", ") : jobDetails.employment_type }}</div>
												</div>
											</div>
										</div>
									</div>
									<!-- Salary Range -->
									<div class="col-xxl-2 col-xl-3 col-lg-4 col-md-6 col-sm-6 col-6">
										<div class="d-flex flex-column">
											<div class="d-flex align-items-center mb-2">
												<i class="fas fa-dollar me-2 text-success"></i>
												<div>
													<span class="text-muted">Salary Offered per Month</span>
													<div class="fw-bold">
														<span class="me-1">{{ jobDetails.currency_code }}</span
														>{{ jobDetails.salary_offer }}
													</div>
												</div>
											</div>
										</div>
									</div>
									<!-- Experience Level -->
									<div class="col-xxl-2 col-xl-3 col-lg-4 col-md-6 col-sm-6 col-6">
										<div class="d-flex flex-column">
											<div class="d-flex align-items-center mb-2">
												<i class="fa-solid fa-user-plus me-2" style="color: black"></i>
												<div>
													<span class="text-muted">Experience Level</span>
													<div class="fw-bold">
														{{ jobDetails.experience_level == "Fresher" ? jobDetails.experience_level : jobDetails.experience_level == "1" ? jobDetails.experience_level + "year" : jobDetails.experience_level + " years" }}
													</div>
												</div>
											</div>
										</div>
									</div>
									<!-- Minimum Educational Requirement -->
									<div class="col-xxl-2 col-xl-3 col-lg-4 col-md-6 col-sm-6 col-6">
										<div class="d-flex flex-column">
											<div class="d-flex align-items-center mb-2">
												<i class="fas fa-user-graduate me-2 text-primary"></i>
												<div>
													<span class="text-muted">Minimum Educational Requirement</span>
													<div class="fw-bold text-break">{{ jobDetails.minimum_education }}</div>
												</div>
											</div>
										</div>
									</div>
									<!-- Department -->
									<div class="col-xxl-2 col-xl-3 col-lg-4 col-md-6 col-sm-6 col-6">
										<div class="d-flex flex-column">
											<div class="d-flex align-items-center mb-2">
												<i class="fas fa-building me-2" style="color: darkblue"></i>
												<div>
													<span class="text-muted">Department</span>
													<div class="fw-bold">{{ jobDetails.department ?? "N/A" }}</div>
												</div>
											</div>
										</div>
									</div>
									<!-- Gender -->
									<div class="col-xxl-2 col-xl-3 col-lg-4 col-md-6 col-sm-6 col-6">
										<div class="d-flex flex-column">
											<div class="d-flex align-items-center mb-2">
												<i class="fa-solid fa-transgender me-2" style="color: darkblue"></i>
												<div>
													<span class="text-muted">Gender Requirements</span>
													<div class="fw-bold">{{ jobDetails.gender_requirement_name ?? "N/A" }}</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- Job Overview -->
						<div class="row mb-2" *ngIf="jobDetails?.job_overview">
							<div class="col-md-12">
								<div class="card-body p-3 p-md-4 bg-secondary-subtle rounded-3">
									<div class="row">
										<div class="col-12 col-md-3 mb-3 mb-md-0">
											<h2 class="fs-3 fw-bold">Job Overview</h2>
										</div>
										<div class="col-12 col-md-9 font-bold">
											<p class="mb-0" [innerHTML]="jobDetails.job_overview"></p>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- Key Responsibilities -->
						<div class="row mb-4" *ngIf="jobDetails?.key_responsibilities">
							<div class="col-md-12">
								<div class="card-body p-3 p-md-4 bg-secondary-subtle rounded-3">
									<div class="row">
										<div class="col-12 col-md-3 mb-3 mb-md-0">
											<h2 class="fs-3 fw-bold">Key<br class="d-none d-md-block" />Responsibilities</h2>
										</div>
										<div class="col-12 col-md-9 font-bold">
											<div [innerHTML]="jobDetails?.key_responsibilities"></div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!-- Language Proficiency -->
						<div class="row mb-4" *ngIf="jobDetails?.languages?.length > 0">
							<div class="col-md-12">
								<div class="card-body p-3 p-md-4 bg-secondary-subtle rounded-3">
									<div class="row">
										<div class="col-12 col-md-3 mb-3 mb-md-0">
											<h2 class="fs-3 fw-bold">Language<br class="d-none d-md-block" />Proficiency</h2>
										</div>
										<div class="col-12 col-md-9">
											<ul class="list-unstyled font-bold">
												<li *ngFor="let lang of jobDetails?.languages" class="mb-3">
													<div class="d-flex align-items-center gap-2">
														<span class="me-2">{{ lang.lang }}</span>
														<p-rating *ngIf="lang.level" style="font-size: large" [ngModel]="getProficiencyRating(lang.level)" [readonly]="true"></p-rating>
													</div>
												</li>
											</ul>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- Compensation Structure -->
						<div class="row mb-4" *ngIf="jobDetails?.compensation_structure?.length > 0">
							<div class="col-md-12">
								<div class="card-body p-3 p-md-4 bg-secondary-subtle rounded-3">
									<div class="row">
										<div class="col-12 col-md-3 mb-3 mb-md-0">
											<h2 class="fs-3 fw-bold">Compensation<br class="d-none d-md-block" />Structure</h2>
										</div>
										<div class="col-12 col-md-9 font-bold">
											<div class="d-flex flex-wrap gap-2">
												<span *ngFor="let comp of jobDetails.compensation_structure" class="border border-warning badge bg-warning text-dark p-2 rounded mb-2 fs-6">{{ comp }}</span>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- Additional Benefits & Perks -->
						<div class="row mb-4" *ngIf="jobDetails?.benefits_perks?.length > 0">
							<div class="col-md-12">
								<div class="card-body p-3 p-md-4 bg-secondary-subtle rounded-3">
									<div class="row">
										<div class="col-12 col-md-3 mb-3 mb-md-0">
											<h2 class="fs-3 fw-bold">Additional Benefits<br class="d-none d-md-block" />& Perks</h2>
										</div>
										<div class="col-12 col-md-9 font-bold">
											<div class="d-flex flex-wrap gap-2">
												<span *ngFor="let benefit of jobDetails.benefits_perks" class="border border-warning badge bg-warning text-dark p-2 rounded mb-2 fs-6">{{ benefit }}</span>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- Essential Soft Skills -->
						<div class="row mb-4" *ngIf="jobDetails?.soft_skills">
							<div class="col-md-12">
								<div class="card-body p-3 p-md-4 bg-secondary-subtle rounded-3">
									<div class="row">
										<div class="col-12 col-md-3 mb-3 mb-md-0">
											<h2 class="fs-3 fw-bold">Essential Soft Skills</h2>
										</div>
										<div class="col-12 col-md-9 font-bold">
											<div class="d-flex flex-wrap gap-2">
												<span *ngFor="let skill of jobDetails?.soft_skills" class="border border-warning badge bg-warning text-dark p-2 rounded mb-2 fs-6">{{ skill }}</span>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- Hiring & Recruitment -->
						<div class="row mb-4" *ngIf="jobDetails?.hiring_stages">
							<div class="col-md-12">
								<div class="card-body p-3 p-md-4 bg-secondary-subtle rounded-3">
									<div class="row">
										<div class="col-12 col-md-3 mb-3 mb-md-0">
											<h2 class="fs-3 fw-bold">Hiring & Recruitment</h2>
										</div>
										<div class="col-12 col-md-9 font-bold">
											<h6 class="mb-2 text-primary">Hiring Process Stages</h6>
											<div class="d-flex flex-wrap gap-2 mb-4">
												<ng-container *ngIf="Array.isArray(jobDetails.hiring_stages) && jobDetails.hiring_stages.length > 0">
													<ng-container *ngIf="jobDetails.hiring_stages[0].id !== undefined">
														<span *ngFor="let stage of jobDetails.hiring_stages" class="border border-warning badge bg-warning text-dark p-2 rounded mb-2 fs-6">{{ stage.name }}</span>
													</ng-container>
													<ng-container *ngIf="jobDetails.hiring_stages[0].id === undefined">
														<span *ngFor="let stage of jobDetails.hiring_stages" class="border border-warning badge bg-warning text-dark p-2 rounded mb-2 fs-6">{{ stage }}</span>
													</ng-container>
												</ng-container>
												<ng-container *ngIf="!Array.isArray(jobDetails.hiring_stages)">
													<span class="badge bg-warning text-dark p-2 rounded mb-2 fs-6">{{ jobDetails.hiring_stages }}</span>
												</ng-container>
											</div>

											<h6 class="mb-2 text-primary">Estimated Hiring Decision Timeframe</h6>
											<p class="mb-4">{{ jobDetails.hiring_timeframe }}</p>

											<h6 class="mb-2 text-primary">Interview Format</h6>
											<div class="d-flex flex-wrap gap-2 mb-4">
												<span *ngFor="let stage of jobDetails.interview_format" class="border border-warning badge bg-warning text-dark p-2 rounded mb-2 fs-6">
													{{ stage }}
												</span>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="row" *ngIf="jobDetails?.additional_notes">
							<div class="col-md-12">
								<div class="card-body p-3 p-md-4 bg-secondary-subtle rounded-3">
									<div class="row">
										<div class="col-12 col-md-3 mb-3 mb-md-0">
											<h2 class="fs-3 fw-bold">Additional Notes</h2>
										</div>
										<div class="col-12 col-md-9 font-bold">
											<div [innerHTML]="jobDetails.additional_notes"></div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-12 d-md-block d-none h-100" *ngIf="isShowApplyChat" [ngClass]="{ 'col-md-5 col-lg-4 col-xl-3 overflow-y-auto': showInfo }">
				<uni-job-chat-ui (openInfo)="showInfo = true" [showInfo]="showInfo" [jobDetails]="jobDetails" [jobId]="appliedId" [isJobApplied]="false" (closeChat)="isShowApplyChat = false"></uni-job-chat-ui>
			</div>
			<p-drawer #drawerRef [(visible)]="visible" position="right" [style]="{ width: '80vw' }">
				<ng-template #headless>
					<uni-job-chat-ui class="h-100" (openInfo)="showInfo = true" [showInfo]="showInfo" [jobDetails]="jobDetails" [jobId]="appliedId" [isJobApplied]="false" (closeChat)="isShowApplyChat = false"></uni-job-chat-ui>
				</ng-template>
			</p-drawer>
		</div>
	</div>
</div>
