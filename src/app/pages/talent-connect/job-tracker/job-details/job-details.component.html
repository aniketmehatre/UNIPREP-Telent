<div class="job-detail-container">
    <div class="card-body">
      <div class="row align-items-center">
        <div class="col-md-1 mx-auto" [ngClass]="{'col-md-2': showChat}">
          <div class="bg-light d-flex justify-content-center align-items-center mx-auto" style="width: 80px; height: 100%; overflow: hidden; border-radius: 5px;">
            <img [src]="jobDetails.company_logo_url" alt="Company Logo" class="img-fluid" style="max-width: 100%; max-height: 100%; object-fit: contain;"/>
          </div>
        </div>
        <div class="col-md-10 col-sm-8 text-start" [ngClass]="{'col-md-11': !showChat}">
          <div class="d-flex justify-content-between">
            <div>
              <h2 class="mb-0">{{ jobDetails.position }}</h2>
              <div class="d-flex align-items-center">
                <span>{{ jobDetails.company_name }}</span>
                <span class="ms-1 text-primary" *ngIf="jobDetails">
                  <i class="fas fa-check-circle"></i>
                </span>         
               </div>
            </div>
        <div class="text-end">
          <button pButton label="Close Info" class="btn btn-primary" (click)="closeInfo.emit(false)" *ngIf="showChat"></button>
          <button pButton class="p-button-success chat-btn" *ngIf="!showChat" (click)="openChat.emit(true)">
            <i class="pi pi-comments"></i> Chat
          </button>          
          <div class="mt-2">
            <small>Applied On: {{ jobDetails.created_at | date: 'dd-MM-yyyy' }}</small>
          </div>
        </div>
      </div>
      </div>
    </div>
  <hr>
  <!-- Application Progress -->
  <div class="mb-4">
      <div class="w-100">
      <p-steps [model]="steps" [activeIndex]="activeIndex" [readonly]="true" class="w-100"></p-steps>
    </div>
  </div>
  <hr>
  <!-- Job Details -->
  <div class="row mb-4 text-start">
    <div class="mb-4 text-start">
      <div class="text-start">
        <div class="row">
          <div class="mb-3 col-lg-3 col-md-3 col-3">
            <div class="d-flex text-left align-items-center">
              <i class="fa-solid fa-location-dot text-success me-2 mt-1"></i>
              <div>
                <p class="text-muted mb-1">Work Location</p>
                <p class="fw-bold mb-0">{{ jobDetails.worklocation || jobDetails.work_location }}</p>
              </div>
            </div>
          </div>
          <div class="col-3 mb-3">
            <div class="d-flex text-left align-items-center">
              <i class="fa-solid fa-briefcase me-2 mt-1" style="color: blue"></i>
              <div>
                <p class="text-muted mb-1">Position</p>
                <p class="fw-bold mb-0">{{ jobDetails.position }}</p>
              </div>
            </div>
          </div>
          <div class="col-3 mb-3">
            <div class="d-flex text-left align-items-center">
              <i class="fa-solid fa-calendar text-primary me-2 mt-1" style="color: purple"></i>
              <div>
                <p class="text-muted mb-1">Start Date</p>
                <p class="fw-bold mb-0">{{ jobDetails.start_date }}</p>
              </div>
            </div>
          </div>
          <div class="col-3 mb-3">
            <div class="d-flex text-left align-items-center">
              <i class="fa-solid fa-users me-2 mt-1"></i>
              <div>
                <p class="text-muted mb-1">Company Size</p>
                <p class="fw-bold mb-0">{{ jobDetails.company_size }}</p>
              </div>
            </div>
          </div>
          <div class="col-3 mb-3">
            <div class="d-flex text-left align-items-center" >
              <i class="fa-solid fa-building text-secondary me-2 mt-1" style="color: var(--uniprep-secondary)"></i>
              <div>
                <p class="text-muted mb-1">Work Mode</p>
                <p class="fw-bold mb-0">
                  <span *ngIf="!array.isArray(jobDetails.work_mode)">{{ jobDetails.work_mode }}</span>
                  <span *ngIf="array.isArray(jobDetails.work_mode)">{{ jobDetails.work_mode.join(', ') }}</span>
                </p>
              </div>
            </div>
          </div>
          <div class="col-3 mb-3">
            <div class="d-flex text-left align-items-center">
              <i class="fa-solid fa-clock  me-2 mt-1" style="color: red"></i>
              <div>
                <p class="text-muted mb-1">Employment Type</p>
                <p class="fw-bold mb-0">
                  <span *ngIf="!array.isArray(jobDetails.employment_type)">{{ jobDetails.employment_type }}</span>
                  <span *ngIf="array.isArray(jobDetails.employment_type)">{{ jobDetails.employment_type.join(', ') }}</span>
                </p>
              </div>
            </div>
          </div>
          <div class="col-3 mb-3">
            <div class="d-flex text-left align-items-center">
              <i class="fa-solid fa-dollar me-2 mt-1" style="color: green"></i>
              <div>
                <p class="text-muted mb-1">Salary Range</p>
                <p class="fw-bold mb-0">
                  {{ jobDetails.salary_range || jobDetails.salary_offer }}
                  <span *ngIf="jobDetails.currency_code"> {{ jobDetails.currency_code }}</span>
                </p>
              </div>
            </div>
          </div>
          <div class="col-3 mb-3">
            <div class="d-flex text-left align-items-center">
              <i class="fa fa-id-card me-2 mt-1"></i>
              <div>
                <p class="text-muted mb-1">Available Vacancies</p>
                <p class="fw-bold mb-0">{{ jobDetails.available_vacancies }}</p>
              </div>
            </div>
          </div>
          <div class="col-3 mb-3">
            <div class="d-flex text-left align-items-center">
              <i class="fas fa-users  me-2 mt-1 text-secondary" ></i>
              <div>
                <p class="text-muted mb-1">Total Applied</p>
                <p class="fw-bold mb-0">{{ jobDetails.total_applied }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr>
    <div class="row mb-4 text-start">
      <div class="col-md-12">
          <div class="card-body p-4 bg-secondary-subtle rounded-3 ">
            <div class="row">
              <div class="col-md-5">
                <h2 class="fs-3 fw-bold word-wrap">Job Overview</h2>
              </div>
              <div class="col-md-7 font-bold">
                <p class="mb-0" [innerHTML]="jobDetails.job_overview"></p>
              </div>
            </div>
        </div>
      </div>
    </div>

    <div class="row mb-4">
      <div class="col-md-12">
          <div class="card-body p-4 bg-secondary-subtle rounded-3 ">
            <div class="row">
              <div class="col-md-5">
                <h2 class="fs-3 fw-bold">Key<br>Responsibilities</h2>
              </div>
              <div class="col-md-7 font-bold">
                <!-- Handle both string and array formats -->
                <div *ngIf="typeof jobDetails.key_responsibilities === 'string'">
                  <p>{{ jobDetails.key_responsibilities }}</p>
                </div>
                <ul *ngIf="array.isArray(jobDetails.key_responsibilities)" class="list-unstyled">
                  <li *ngFor="let resp of jobDetails.key_responsibilities" class="mb-3">
                    <div class="d-flex">
                      <i class="pi pi-circle-fill me-2 mt-1" style="font-size: 8px;"></i>
                      <span>{{ resp }}</span>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
    </div>

    <!-- Technical Proficiency -->
    <div class="row mb-4">
      <div class="col-md-12">
          <div class="card-body p-4 bg-secondary-subtle rounded-3 ">
            <div class="row">
              <div class="col-md-5">
                <h2 class="fs-3 fw-bold">Technical<br>Proficiency</h2>
              </div>
              <div class="col-md-7 font-bold">
                <p>{{ jobDetails.technical_proficiency }}</p>
              </div>
            </div>
          </div>
        </div>
    </div>

    <!-- Language Proficiency -->
    <div class="row mb-4">
      <div class="col-md-12">
          <div class="card-body p-4 bg-secondary-subtle rounded-3 ">
            <div class="row">
              <div class="col-md-5">
                <h2 class="fs-3 fw-bold">Language<br>Proficiency</h2>
              </div>
              <div class="col-md-7">
                <!-- Parse the language proficiency string format [language,level] -->
                <ul class="list-unstyled font-bold">
                  <ng-container *ngIf="jobDetails.language_proficiency && typeof jobDetails.language_proficiency === 'string'">
                    <ng-container *ngFor="let langString of jobDetails.language_proficiency.split('],[')">
                      <li class="mb-3" *ngIf="langString">
                        <div class="d-flex gap-2">
                          <span>{{ langString.replace('[', '').replace(']', '').split(',')[0] }}</span>
                          <span class="d-flex gap-2">
                            <i class="fa-solid fa-star text-warning"></i>
                            <i class="fa-solid fa-star text-warning"></i>
                            <i class="fa-solid fa-star text-warning"></i>
                            <i class="fa-solid fa-star text-warning"></i>
                            <i class="fa fa-star"></i>
                          </span>
                        </div>
                      </li>
                    </ng-container>
                  </ng-container>
                  <!-- Handle the array format -->
                  <ng-container *ngIf="jobDetails.language_proficiency && array.isArray(jobDetails.language_proficiency)">
                    <li *ngFor="let lang of jobDetails.language_proficiency" class="mb-3">
                      <div class="d-flex gap-2">
                        <span>{{ lang.language }}</span>
                        <span class="d-flex gap-2">
                          <i class="fa-solid fa-star text-warning"></i>
                          <i class="fa-solid fa-star text-warning"></i>
                          <i class="fa-solid fa-star text-warning"></i>
                          <i class="fa-solid fa-star text-warning"></i>
                          <i class="fa fa-star"></i>
                        </span>
                      </div>
                    </li>
                  </ng-container>
                </ul>
              </div>
            </div>
          </div>
      </div>
    </div>

    <!-- Compensation Structure -->
    <div class="row mb-4">
      <div class="col-md-12">
          <div class="card-body p-4 bg-secondary-subtle rounded-3 ">
            <div class="row">
              <div class="col-md-5">
                <h2 class="fs-3 fw-bold">Compensation<br>Structure</h2>
              </div>
              <div class="col-md-7 font-bold">
                <div class="d-flex flex-wrap gap-2">
                  <!-- Handle both string and array formats -->
                  <ng-container *ngIf="!array.isArray(jobDetails.compensation_structure)">
                    <span class="badge bg-warning-sub text-dark fw-medium p-2 rounded">{{ jobDetails.compensation_structure }}</span>
                  </ng-container>
                  <ng-container *ngIf="array.isArray(jobDetails.compensation_structure)">
                    <span *ngFor="let comp of jobDetails.compensation_structure" class="badge bg-warning-sub text-dark fw-medium p-2 rounded">{{ comp }}</span>
                  </ng-container>
                </div>
              </div>
            </div>
          </div>
      </div>
    </div>

    <!-- Additional Benefits & Perks -->
    <div class="row mb-4">
      <div class="col-md-12">
          <div class="card-body p-4 bg-secondary-subtle rounded-3 ">
            <div class="row">
              <div class="col-md-5">
                <h2 class="fs-3 fw-bold">Additional Benefits<br>& Perks</h2>
              </div>
              <div class="col-md-7 font-bold">
                <div class="d-flex flex-wrap gap-2">
                  <!-- Handle both string and array formats -->
                  <ng-container *ngIf="!array.isArray(jobDetails.benefits_perks)">
                    <span class="badge bg-warning-sub text-dark fw-medium p-2 rounded">{{ jobDetails.benefits_perks }}</span>
                  </ng-container>
                  <ng-container *ngIf="array.isArray(jobDetails.benefits_perks)">
                    <span *ngFor="let benefit of jobDetails.benefits_perks" class="badge bg-warning-sub text-dark fw-medium p-2 rounded">{{ benefit }}</span>
                  </ng-container>
                </div>
              </div>
            </div>
          </div>
    </div>

    <!-- Essential Soft Skills -->
    <div class="row mb-4">
      <div class="col-md-12">
          <div class="card-body p-4 bg-secondary-subtle rounded-3 ">
            <div class="row">
              <div class="col-md-5">
                <h2 class="fs-3 fw-bold">Essential Soft Skills</h2>
              </div>
              <div class="col-md-7 font-bold">
                <div class="d-flex flex-wrap gap-2">
                  <!-- Handle both string and array formats -->
                  <ng-container *ngIf="!array.isArray(jobDetails.soft_skills)">
                    <span class="badge bg-warning-sub text-dark fw-medium p-2 rounded">{{ jobDetails.soft_skills }}</span>
                  </ng-container>
                  <ng-container *ngIf="array.isArray(jobDetails.soft_skills)">
                    <span *ngFor="let skill of jobDetails.soft_skills" class="badge bg-warning-sub text-dark fw-medium p-2 rounded">{{ skill }}</span>
                  </ng-container>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Hiring & Recruitment -->
    <div class="row mb-4">
      <div class="col-md-12">
          <div class="card-body p-4 bg-secondary-subtle rounded-3 ">
            <div class="row">
              <div class="col-md-5">
                <h2 class="fs-3 fw-bold">Hiring & Recruitment</h2>
              </div>
              <div class="col-md-7 font-bold">
                <h6 class="mb-2">Hiring Process Stages</h6>
                <div class="d-flex flex-wrap gap-2 mb-4">
                  <!-- Handle different hiring_stages formats -->
                  <ng-container *ngIf="!array.isArray(jobDetails.hiring_stages)">
                    <span class="badge bg-warning-sub text-dark fw-medium p-2 rounded">{{ jobDetails.hiring_stages }}</span>
                  </ng-container>
                  <ng-container *ngIf="array.isArray(jobDetails.hiring_stages)">
                    <span *ngFor="let stage of jobDetails.hiring_stages" class="badge bg-warning-sub text-dark fw-medium p-2 rounded">
                      {{ stage.name || stage }}
                    </span>
                  </ng-container>
                </div>

                <h6 class="mb-2">Estimated Hiring Decision Timeframe</h6>
                <p class="mb-4">{{ jobDetails.hiring_timeframe }}</p>

                <h6 class="mb-2">Interview Format</h6>
                <span *ngFor="let stage of jobDetails.interview_format" class="badge bg-warning-sub text-dark fw-medium p-2 rounded">
                  {{ stage }}
                </span>
              </div>
            </div>
          </div>
        </div>
    </div>
    
  </div>
</div>