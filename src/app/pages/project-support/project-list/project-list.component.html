<div class="project-list-container p-4">
  <!-- Top Selection Card -->
  <div class="card mb-4 border-0 shadow-sm rounded-3">
    <div class="card-body">
      <div class="row align-items-end">
        <div class="col-md-10">
          <label class="form-label fw-bold mb-2">Service Type</label>
          <p-select [options]="serviceTypes" optionLabel="name" placeholder="Select Service Type"
            class="w-100 custom-select"></p-select>
        </div>
        <div class="col-md-2 text-end">
          <p-button label="Edit" styleClass="p-button-secondary custom-edit-btn"></p-button>
        </div>
      </div>
    </div>
  </div>

  <!-- Search and Table Section -->
  <div class="table-card p-3 bg-white shadow-sm rounded-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div class="flex-grow-1 me-3">
        <div class="bg-light p-2 rounded ps-3 fw-bold text-muted">
          {{ searchTerm ? 'Searching for: ' + searchTerm : 'All Projects' }}
        </div>
      </div>
      <div class="search-container" [formGroup]="searchForm">
        <p-iconfield>
          <p-inputicon styleClass="pi pi-search" />
          <input type="text" pInputText placeholder="Search Projects..." formControlName="search"
            class="custom-search-input" />
        </p-iconfield>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="text-center py-5">
      <i class="pi pi-spin pi-spinner" style="font-size: 2rem; color: #435084"></i>
      <p class="mt-2 text-muted">Loading projects...</p>
    </div>

    <!-- No Data State -->
    <div *ngIf="!isLoading && filteredProjects.length === 0" class="text-center py-5">
      <i class="pi pi-folder-open text-muted mb-3" style="font-size: 3rem"></i>
      <p class="text-muted">No projects found matching your criteria.</p>
    </div>

    <!-- Dynamic Table -->
    <p-table *ngIf="!isLoading && filteredProjects.length > 0" [value]="filteredProjects" [responsiveLayout]="'scroll'"
      class="custom-table" [paginator]="true" [rows]="pageSize" [totalRecords]="totalProjects" [lazy]="true"
      (onPage)="onPageChange($event)">
      <ng-template pTemplate="header">
        <tr>
          <th>Project ID</th>
          <th>Project Name</th>
          <th>Service Type</th>
          <th>Freelancing Type</th>
          <th>Priority</th>
          <th>Status</th>
          <th>Payment</th>
          <th>Project Start Date</th>
          <th>Project Deadline</th>
          <th></th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-project>
        <tr>
          <td class="fw-bold text-primary">{{ getProjectId(project) }}</td>
          <td>
            <div class="d-flex align-items-center">
              <span class="text-truncate" style="max-width: 150px;" [pTooltip]="getProjectName(project)">
                {{ getProjectName(project) }}
              </span>
              <p-tag *ngIf="getBadgeCount(project) > 0" [value]="getBadgeCount(project).toString()" severity="info"
                class="ms-2"></p-tag>
            </div>
          </td>
          <td>{{ getServiceType(project) }}</td>
          <td>{{ getFreelancingType(project) }}</td>
          <td>
            <p-tag [value]="getProjectPriority(project)"
              [severity]="getPrioritySeverity(getProjectPriority(project))"></p-tag>
          </td>
          <td>
            <p-tag [value]="getProjectStatus(project)" [severity]="getStatusSeverity(getProjectStatus(project))"></p-tag>
          </td>
          <td>
            <span class="small font-monospace">{{ getPaymentStatus(project) }}</span>
          </td>
          <td class="text-muted small">{{ project.project_start_date || project.startDate || 'N/A' }}</td>
          <td class="text-muted small">{{ project.project_deadline || project.deadline || 'N/A' }}</td>
          <td>
            <p-button label="View" (onClick)="viewProject(project)" styleClass="p-button-sm custom-view-btn"></p-button>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
